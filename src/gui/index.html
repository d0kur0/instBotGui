<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>InstBot Gui</title>
    <link rel="stylesheet" href="styles/spectre-exp.min.css" />
    <link rel="stylesheet" href="styles/spectre-icons.min.css" />
    <link rel="stylesheet" href="styles/spectre.min.css" />
    <link rel="stylesheet" href="styles/root.css" />
    <script src="renderScripts.js"></script>
  </head>
  <body>
    <div class="sticky-save-button">
      <button id="save-button" class="btn btn-success">Сохранить</button>
      <button id="start-button" class="btn btn-success">Запустить</button>
    </div>

    <div class="columns">
      <div class="column col-6">
        <fieldset>
          <legend>Список комментариев (разделитель - перенос строки)</legend>
          <div class="form-group">
            <label class="form-label" for="messagesList"></label>
            <textarea name="messages" class="form-input" id="messagesList" placeholder="Awesome)" rows="10"></textarea>
          </div>
        </fieldset>
        <fieldset>
          <legend>Список хештегов и локаций</legend>
          <div class="form-group">
            <label class="form-label" for="hashTags"
              >Список хештегов и локаций вида: <b>tags/ИМЯТЕГА</b> или <b>location/ЛОКАЦИЯ</b>, каждая
              <b>строка - отдельное значение</b>, эти значения нужно брать прямо из адресной строки инстаграмма
            </label>
            <textarea name="hashTags" class="form-input" id="hashTags" placeholder="tags/маникюр" rows="10"></textarea>
          </div>
        </fieldset>
      </div>
      <div class="column col-6">
        <fieldset>
          <legend>Данные авторизации</legend>
          <div class="columns">
            <div class="column col-6">
              <div class="form-group">
                <label class="form-label" for="username">Логин от инстаграмма</label>
                <input name="username" class="form-input" type="text" id="username" placeholder="Inst username" />
              </div>
            </div>
            <div class="column col-6">
              <div class="form-group">
                <label class="form-label" for="password">Пароль от инстаграмма</label>
                <input class="form-input" type="text" id="password" name="password" placeholder="Inst password" />
              </div>
            </div>
          </div>
        </fieldset>
        <fieldset>
          <legend>Настройки бота</legend>
          <div class="columns">
            <div class="column col-12">
              <div class="form-group">
                <label class="form-checkbox">
                  <input type="checkbox" name="headless" checked="" /><i class="form-icon"></i>
                  Запускать браузер в скрытом режиме
                </label>
              </div>
            </div>

            <div class="column col-12">
              <div class="form-group">
                <label class="form-label" for="args">Аргументы запуска puppeteer, через запятую</label>
                <input
                  name="args"
                  class="form-input"
                  type="text"
                  id="args"
                  placeholder="--disable-notification, --no-sandbox"
                />
              </div>
            </div>
          </div>
        </fieldset>
        <fieldset>
          <legend>Настройки бота</legend>
          <div class="columns">
            <div class="column col-6">
              <div class="form-group">
                <label class="form-label" for="delayBeforeComment">Пауза после комментария (мс)</label>
                <input
                  name="delayBeforeComment"
                  class="form-input"
                  type="number"
                  id="delayBeforeComment"
                  placeholder="500"
                />
              </div>
            </div>
            <div class="column col-6">
              <div class="form-group">
                <label class="form-label" for="delayBeforeIteration">Пауза между постами (мс) </label>
                <input
                  class="form-input"
                  type="number"
                  name="delayBeforeIteration"
                  id="delayBeforeIteration"
                  placeholder="5000"
                />
              </div>
            </div>
            <div class="column col-6">
              <div class="form-group">
                <label class="form-label" for="delayBeforeLike">Пауза после лайка (мс) </label>
                <input
                  class="form-input"
                  type="number"
                  name="delayBeforeLike"
                  id="delayBeforeLike"
                  placeholder="5000"
                />
              </div>
            </div>
            <div class="column col-6">
              <div class="form-group">
                <label class="form-label" for="delayBeforeSubscribe">Пауза после подписки (мс) </label>
                <input
                  class="form-input"
                  type="number"
                  name="delayBeforeSubscribe"
                  id="delayBeforeSubscribe"
                  placeholder="5000"
                />
              </div>
            </div>
            <div class="column col-12">
              <div class="form-group">
                <label class="form-label" for="changeAfter">Смена хештега\локации каждые (мс):</label>
                <input class="form-input" type="number" name="changeAfter" id="changeAfter" placeholder="1800" />
              </div>
            </div>
          </div>
        </fieldset>
        <fieldset>
          <legend>Лимиты</legend>
          <div class="columns">
            <div class="column col-4">
              <div class="form-group">
                <label class="form-label" for="maxLikesPeerDay">Лимит лайков в день</label>
                <input name="maxLikesPeerDay" class="form-input" type="number" id="maxLikesPeerDay" placeholder="180" />
              </div>
            </div>

            <div class="column col-4">
              <div class="form-group">
                <label class="form-label" for="maxSubscribesPeerDay">Лимит подписок в день</label>
                <input
                  name="maxSubscribesPeerDay"
                  class="form-input"
                  type="number"
                  id="maxSubscribesPeerDay"
                  placeholder="180"
                />
              </div>
            </div>

            <div class="column col-4">
              <div class="form-group">
                <label class="form-label" for="maxCommentsPeerDay">Лимит комментариев в день</label>
                <input
                  name="maxCommentsPeerDay"
                  class="form-input"
                  type="number"
                  id="maxCommentsPeerDay"
                  placeholder="180"
                />
              </div>
            </div>
          </div>
        </fieldset>
      </div>
    </div>

    <script>
      const blockUI = () => document.body.classList.add("blocked");
      const unBlockUI = () => document.body.classList.remove("blocked");

      const saveButton = document.getElementById("save-button");
      const startButton = document.getElementById("start-button");

      const { ipcRenderer } = require("electron");
      let dataObject = {};

      ipcRenderer.on("data-object", (event, { payload }) => {
        dataObject = payload;

        const fields = document.querySelectorAll("input,textarea");
        fields.forEach(field => {
          switch (field.name) {
            case "messages":
              field.value = payload.messages.join("\n");
              break;
            case "hashTags":
              field.value = payload.hashTags.join("\n");
              break;
            case "username":
              field.value = payload.auth.username;
              break;
            case "password":
              field.value = payload.auth.password;
              break;
            case "headless":
              field.checked = payload.browserSettings.headless;
              break;
            case "args":
              field.value = payload.browserSettings.args.join(", ");
              break;
            case "delayBeforeComment":
              field.value = payload.botSettings.delayBeforeComment;
              break;
            case "delayBeforeIteration":
              field.value = payload.botSettings.delayBeforeIteration;
              break;
            case "delayBeforeLike":
              field.value = payload.botSettings.delayBeforeLike;
              break;
            case "delayBeforeSubscribe":
              field.value = payload.botSettings.delayBeforeSubscribe;
              break;
            case "maxLikesPeerDay":
              field.value = payload.botSettings.maxLikesPeerDay;
              break;
            case "maxSubscribesPeerDay":
              field.value = payload.botSettings.maxSubscribesPeerDay;
              break;
            case "maxCommentsPeerDay":
              field.value = payload.botSettings.maxCommentsPeerDay;
              break;
            case "changeAfter":
              field.value = payload.botSettings.changeAfter;
              break;
          }
        });
      });

      saveButton.addEventListener("click", () => {
        blockUI();

        const fields = document.querySelectorAll("input,textarea");
        fields.forEach(field => {
          switch (field.name) {
            case "messages":
              dataObject.messages = field.value.split("\n");
              break;
            case "hashTags":
              dataObject.hashTags = field.value.split("\n");
              break;
            case "username":
              dataObject.auth.username = field.value;
              break;
            case "password":
              dataObject.auth.password = field.value;
              break;
            case "headless":
              dataObject.browserSettings.headless = Boolean(field.checked);
              break;
            case "args":
              dataObject.browserSettings.args = field.value.split(", ");
              break;
            case "delayBeforeComment":
              dataObject.botSettings.delayBeforeComment = +field.value;
              break;
            case "delayBeforeIteration":
              dataObject.botSettings.delayBeforeIteration = +field.value;
              break;
            case "delayBeforeLike":
              dataObject.botSettings.delayBeforeLike = +field.value;
              break;
            case "delayBeforeSubscribe":
              dataObject.botSettings.delayBeforeSubscribe = +field.value;
              break;
            case "maxLikesPeerDay":
              dataObject.botSettings.maxLikesPeerDay = +field.value;
              break;
            case "maxSubscribesPeerDay":
              dataObject.botSettings.maxSubscribesPeerDay = +field.value;
              break;
            case "maxCommentsPeerDay":
              dataObject.botSettings.maxCommentsPeerDay = +field.value;
              break;
            case "changeAfter":
              dataObject.botSettings.changeAfter = +field.value;
              break;
          }
        });

        ipcRenderer.invoke("save", { payload: dataObject });
      });

      startButton.addEventListener("click", () => {
        blockUI();
        ipcRenderer.invoke("start-bot");
      });

      ipcRenderer.on("save-error", () => {
        unBlockUI();
        new Notification("InstBotGui: Ошибка", {
          body: "Ошибка сохранения, обратитесь к разработчику",
        });
      });

      ipcRenderer.on("save-success", () => {
        unBlockUI();
        new Notification("InstBotGui: Сохранено", {
          body: "Данные были успешно сохранены",
        });
      });

      ipcRenderer.on("close-bot", () => unBlockUI());
    </script>
  </body>
</html>
